---
title: "R Notebook"
output: html_notebook
---

---
title: "R Notebook"
output: html_notebook
---

#load libraries

library(readr)
library(tidyverse)
library(dplyr)
library(lubridate)
library(tidyr)
library(kableExtra)
library(knitr)
library(fastDummies)

CLEANING AND PROCESSING THE DATA

#Loading original datast
tsa_claims <- read_csv("tsa_claims.csv")

#exploring data summary, structure and types

str(tsa_claims)
summary(tsa_claims)


#Renaming the non-standard variables with standard names

TSA_claims <- tsa_claims %>%
  rename(Claim_Number =  `Claim Number`,
         Date_Received = `Date Received`,
         Incident_Date = `Incident Date`,
         Airport_Code = `Airport Code`,
         Airport_Name = `Airport Name`,
         Airline_Name = `Airline Name`,
         Claim_Type = `Claim Type`,
         Claim_Site = `Claim Site`,
         Claim_Amount = `Claim Amount`,
         Close_Amount = `Close Amount`)
TSA_claims

#Remove unwanted characters from specific variables, specifically Claim_Amount & Close_Amount

TSA_claims <- TSA_claims %>%
  mutate_if(is.character, str_replace_all, pattern = '[$]', replacement = '') %>%
  mutate_if(is.character, str_replace_all, pattern = '[;]', replacement = '') %>%
  #Convert data type for specific variables
  mutate(
         Date_Received = dmy(Date_Received),
         Incident_Date = mdy(Incident_Date),
         Airport_Code = as_factor(Airport_Code),
         Claim_Type = as_factor(Claim_Type),
         Claim_Site = as_factor(Claim_Site),
         Claim_Amount = as.double(Claim_Amount),
         Status = as_factor(Status),
         Close_Amount = as.double(Close_Amount),
         Disposition = as_factor(Disposition)
         )

#Verifying conversion to TSA_claims tbl

str(TSA_claims)
summary(TSA_claims)

Columns: Discusss exploration of the following variables
1.  Claim_Number - NA
2.  Date_Received - This represents the dates when claims where received by the TSA.
3.  Incident_Date - This is the date the actual incident ocurred that lead to a claim
    Explore possible relationships between the time an incident and when a claim is filed for said incident
4. Airport_Code - FAA designated code for a specific airport
5. Airport_Name - Name of the Airport
    Verify that all listed Airport codes have corresponding Airport names. We will attempt to convert airport codes to dummy       variables and apply categorical variable imputation methods to see if we can address NAs in these columns
6.  Airline_Name
7.  Claim_Type - Type of claim
    Convert to dummy variables and apply imputation techniques to address NAs
8.  Claim_Site - where in the Airport, the incident may have occurred
    Convert to dummy variables and apply imputation techniques to address NAs
9.  Item - Items for which a claim is being made
10. Claim_Amount - amount being requested by the claimant
    Apply imputation techniques to address NAs
11. Status - preliminary status of claim
    Convert to dummy variables and apply imputation techniques to address NAs
12. Close_Amount - amount that was granted by the TSA
    Apply imputation techniques to address NAs
13. Disposition - Final decision
    Response variable

Inspecting NAs in all columns

na_tsa <- TSA_tbl %>%
  select(everything()) %>%
  summarise_all(funs(sum(is.na(.)))) 

t(na_tsa)




DATA COLUMNS

Approximately 1600 observations in the dataset have Incident Dates that occus after the date the claim was received (Date_Received). For the purposes of this project, we will modify the Incident_Date of those observations using the duration period derived and adjusting them to precede the Date received

TSA_claims %>%
  select(Date_Received, Incident_Date) %>%
  mutate(Duration = Date_Received - Incident_Date) %>%
  mutate(New_Incident_Date = ifelse(Duration < 0, Date_Received + Duration, as.Date(Incident_Date))) %>%
  mutate(New_Incident_Date = as.Date(New_Incident_Date, origin = "1970-01-01"))
